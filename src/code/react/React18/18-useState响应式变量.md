---
category: react18
date: 2023-03-01 21:59
title: 18-useStateå“åº”å¼å˜é‡
updated: 2023-05-13 22:56
---

> ä»£ç ä¹Ÿæ˜¯æœ‰åå°çš„ xswlğŸ¤£

state å’Œ props ç±»ä¼¼ï¼Œéƒ½æ˜¯ä¸€ç§å­˜å‚¨å±æ€§çš„æ–¹å¼ï¼Œä½†æ˜¯ä¸åŒç‚¹åœ¨äº state åªå±äºå½“å‰ç»„ä»¶ï¼Œå…¶ä»–ç»„ä»¶æ— æ³•è®¿é—®ã€‚å¹¶ä¸” state æ˜¯å¯å˜çš„ï¼Œå½“å…¶å‘ç”Ÿå˜åŒ–åç»„ä»¶ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“ï¼Œä»¥ä½¿å˜åŒ–åœ¨é¡µé¢ä¸­å‘ˆç°ã€‚

# state

åœ¨ React ä¸­ï¼Œå½“ç»„ä»¶æ¸²æŸ“å®Œæ¯•åï¼Œå†ä¿®æ”¹ç»„ä»¶ä¸­çš„å˜é‡ï¼Œä¸ä¼šä½¿ç»„ä»¶é‡æ–°æ¸²æŸ“

è¦ä½¿å¾—ç»„ä»¶å¯ä»¥æ”¶åˆ°å˜é‡çš„å½±å“ï¼Œå¿…é¡»åœ¨å˜é‡ä¿®æ”¹åå¯¹ç»„ä»¶è¿›è¡Œé‡æ–°æ¸²æŸ“
è¿™é‡Œæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªç‰¹æ®Šå˜é‡ï¼Œå½“è¿™ä¸ªå˜é‡è¢«ä¿®æ”¹ä½¿ï¼Œç»„ä»¶ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“

state ç›¸å½“äºä¸€ä¸ªå˜é‡ï¼Œ

åªæ˜¯è¿™ä¸ªå˜é‡åœ¨ React ä¸­è¿›è¡Œäº†æ³¨å†Œï¼Œ
React ä¼šç›‘æ§è¿™ä¸ªå˜é‡çš„å˜åŒ–ï¼Œå½“ state å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“
ä½¿å¾—æˆ‘ä»¬çš„ä¿®æ”¹å¯ä»¥åœ¨é¡µé¢ä¸­å‘ˆç°å‡ºæ¥
åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ [é’©å­å‡½æ•°](18.a-hooké’©å­å‡½æ•°.md) ï¼Œè·å– state

## æ ‡å‡†å†™æ³•

ä½¿ç”¨é’©å­ useState() æ¥åˆ›å»º state

```js
import {useState} from "react";
```

å®ƒéœ€è¦ä¸€ä¸ªå€¼ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå€¼å°±æ˜¯ state çš„åˆå§‹å€¼

è¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªæ•°ç»„

- æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ˜¯==åˆå§‹å€¼== - åˆå§‹å€¼åªç”¨æ¥æ˜¾ç¤ºæ•°æ®ï¼Œç›´æ¥ä¿®æ”¹ä¸ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“
- æ•°ç»„ä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé€šå¸¸ä¼šå‘½åä¸º setXxx - è¿™ä¸ªå‡½æ•°ç”¨æ¥ä¿®æ”¹ stateï¼Œè°ƒç”¨å…¶ä¿®æ”¹ state åä¼š==è§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“==ï¼Œå¹¶ä¸”ä½¿ç”¨å‡½æ•°ä¸­çš„å€¼ä½œä¸ºæ–°çš„ state å€¼

```jsx
const [counter, setCounter] = useState(1);
const addHandler = () => {
  setCounter(counter + 1); // å°†counterå€¼ä¿®æ”¹ä¸º2
};

return <div className={'app'}>
    <h1>{counter}</h1>
    <button onClick={addHandler}>+</button>
  </div>;
```

ç­‰ä»·äº

```js
const result = useState(1);
// counter æ˜¯åˆå€¼
let counter = result[0];
// setCounter è°ƒç”¨è¯¥å‡½æ•°ï¼Œé‡æ–°æ¸²æŸ“è§†å›¾
let setCounter = result[1];
```

`setCounter` å…¶å®å°±æ˜¯ é‡æ–°è°ƒç”¨ `render` å‡½æ•°ï¼Œåˆå› ä¸º `diff` ç®—æ³•ï¼Œå¦‚æœå…ƒç´ ä¸å‘ç”Ÿæ”¹å˜ï¼Œä¸ä¼šè°ƒç”¨ render

## æ³¨æ„äº‹é¡¹

- å½“ state çš„å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¿®æ”¹æ—¶æ˜¯ä½¿ç”¨æ–°çš„å¯¹è±¡å»æ›¿æ¢å·²æœ‰å¯¹è±¡ã€‚==ä¿®æ”¹å¯¹è±¡çš„å±æ€§ä¸ä¼šè§¦å‘ diff ç®—æ³•==ï¼Œ
  - ç”¨æµ…æ‹·è´ï¼Œå¯ä»¥ç”Ÿæˆæ–°å¯¹è±¡ï¼Œå†ä¿®æ”¹æ–°å¯¹è±¡çš„å±æ€§å€¼ `const newObj = Object.assign({}, Obj); newObj.age=18.setObj(newObj)`
  - `setuser({...user,age:19})` ï¼ŒåŸºç¡€å¥½çš„è¯å°±å¯ä»¥è¿™æ ·
- å½“é€šè¿‡ setState å»ä¿®æ”¹ä¸€ä¸ª state æ—¶ï¼Œå¹¶ä¸è¡¨ç¤ºä¿®æ”¹å½“å‰çš„ state
  å®ƒä¿®æ”¹çš„æ˜¯ç»„ä»¶==ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶ state å€¼==
  - `const counter = 1;` counter æ˜¯å¸¸é‡ï¼Œä¹Ÿä¸èƒ½ä¿®æ”¹çš„
- setState()ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œå®ƒæ˜¯å¼‚æ­¥çš„ã€‚
  - åœ¨å¼‚æ­¥é˜Ÿåˆ—ï¼Œç­‰å¾…ä¸»çº¿ç¨‹è®¡ç®—å®Œæˆï¼Œå†æ¸²æŸ“ã€‚æ‰€ä»¥å½“è°ƒç”¨ setState()éœ€è¦ç”¨æ—§ state çš„å€¼æ—¶ï¼Œä¸€å®šè¦æ³¨æ„æœ‰å¯èƒ½å‡ºç°è®¡ç®—é”™è¯¯çš„æƒ…å†µ
  - ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥é€šè¿‡ä¸º setState()ä¼ é€’å›è°ƒå‡½æ•°çš„å½¢å¼æ¥ä¿®æ”¹ state å€¼

```js
const addHandler = () => {
    setTimeout(() => {
        // setCounter(counter + 1); // å°†counterå€¼ä¿®æ”¹ä¸º2
        setCounter((prevCounter)=>{

            /*
            *   setState()ä¸­å›è°ƒå‡½æ•°çš„è¿”å›å€¼å°†ä¼šæˆä¸ºæ–°çš„stateå€¼
            *       å›è°ƒå‡½æ•°æ‰§è¡Œæ—¶ï¼ŒReactä¼šå°†æœ€æ–°çš„stateå€¼ä½œä¸ºå‚æ•°ä¼ é€’
            * */
            return prevCounter + 1;
        });

        // setCounter(prevState => prevState + 1);
    }, 1000);

```

- setState ä¸­çš„å›è°ƒå‡½æ•°æ˜¯å¼‚æ­¥å›è°ƒï¼Œå°†ä¼šæŠŠå½“å‰åŒæ­¥å‡½æ•°æ‰§è¡Œä¸€éï¼Œå†æ‰§è¡Œå›è°ƒï¼Œå› æ­¤è·å¾—çš„æ˜¯æœ€æ–°çš„å€¼