const n=JSON.parse('{"key":"v-1eb19386","path":"/code/react/React-demo/1e-%E8%87%AA%E5%8A%A8%E7%99%BB%E5%87%BA.html","title":"1e-自动登出","lang":"zh-CN","frontmatter":{"category":"react18","title":"1e-自动登出","updated":"2023-05-13 22:56","description":"创建一个useEffect，用来处理登录状态 设置定时函数执行 回调函数 取消定时函数 import {useDispatch, useSelector} from \\"react-redux\\"; import {useEffect} from \\"react\\"; import {logout} from \\"../store/reducer/authSlice\\"; const useAutoLogout = () =&gt; { const auth = useSelector(state =&gt; state.auth); const dispatch = useDispatch(); // 创建一个useEffect，用来处理登录状态 useEffect(() =&gt; { const timeout = auth.expirationTime - Date.now(); // 判断timeout的值 if (timeout &lt; 6000) { dispatch(logout()); return; } const timer = setTimeout(() =&gt; { dispatch(logout()); }, timeout); return () =&gt; { clearTimeout(timer); }; }, [auth]); }; export default useAutoLogout;","head":[["meta",{"property":"og:url","content":"https://johno666.github.io/code/react/React-demo/1e-%E8%87%AA%E5%8A%A8%E7%99%BB%E5%87%BA.html"}],["meta",{"property":"og:site_name","content":"小阿俊@博客"}],["meta",{"property":"og:title","content":"1e-自动登出"}],["meta",{"property":"og:description","content":"创建一个useEffect，用来处理登录状态 设置定时函数执行 回调函数 取消定时函数 import {useDispatch, useSelector} from \\"react-redux\\"; import {useEffect} from \\"react\\"; import {logout} from \\"../store/reducer/authSlice\\"; const useAutoLogout = () =&gt; { const auth = useSelector(state =&gt; state.auth); const dispatch = useDispatch(); // 创建一个useEffect，用来处理登录状态 useEffect(() =&gt; { const timeout = auth.expirationTime - Date.now(); // 判断timeout的值 if (timeout &lt; 6000) { dispatch(logout()); return; } const timer = setTimeout(() =&gt; { dispatch(logout()); }, timeout); return () =&gt; { clearTimeout(timer); }; }, [auth]); }; export default useAutoLogout;"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-09-19T06:11:13.000Z"}],["meta",{"property":"article:author","content":"XiaoAjun"}],["meta",{"property":"article:modified_time","content":"2023-09-19T06:11:13.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"1e-自动登出\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-09-19T06:11:13.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"XiaoAjun\\",\\"url\\":\\"https://johno666.github.io/\\"}]}"]]},"headers":[{"level":2,"title":"创建一个useEffect，用来处理登录状态","slug":"创建一个useeffect-用来处理登录状态","link":"#创建一个useeffect-用来处理登录状态","children":[]},{"level":2,"title":"封装成 一个自定义hook useAutoLogout","slug":"封装成-一个自定义hook-useautologout","link":"#封装成-一个自定义hook-useautologout","children":[]}],"git":{"createdTime":1695103873000,"updatedTime":1695103873000,"contributors":[{"name":"张伟竣","email":"2938795170@qq.com","commits":1}]},"readingTime":{"minutes":0.54,"words":163},"filePathRelative":"code/react/React-demo/1e-自动登出.md","localizedDate":"2023年9月19日","excerpt":"<h2> 创建一个useEffect，用来处理登录状态</h2>\\n<p>设置定时函数执行<br>\\n回调函数 取消定时函数</p>\\n<div class=\\"language-jsx line-numbers-mode\\" data-ext=\\"jsx\\"><pre class=\\"language-jsx\\"><code><span class=\\"token keyword\\">import</span> <span class=\\"token punctuation\\">{</span>useDispatch<span class=\\"token punctuation\\">,</span> useSelector<span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">\\"react-redux\\"</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">import</span> <span class=\\"token punctuation\\">{</span>useEffect<span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">\\"react\\"</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">import</span> <span class=\\"token punctuation\\">{</span>logout<span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">\\"../store/reducer/authSlice\\"</span><span class=\\"token punctuation\\">;</span>\\n\\n<span class=\\"token keyword\\">const</span> <span class=\\"token function-variable function\\">useAutoLogout</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=&gt;</span> <span class=\\"token punctuation\\">{</span>\\n    <span class=\\"token keyword\\">const</span> auth <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useSelector</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">state</span> <span class=\\"token operator\\">=&gt;</span> state<span class=\\"token punctuation\\">.</span>auth<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n    <span class=\\"token keyword\\">const</span> dispatch <span class=\\"token operator\\">=</span> <span class=\\"token function\\">useDispatch</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n\\n    <span class=\\"token comment\\">// 创建一个useEffect，用来处理登录状态</span>\\n    <span class=\\"token function\\">useEffect</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=&gt;</span> <span class=\\"token punctuation\\">{</span>\\n        <span class=\\"token keyword\\">const</span> timeout <span class=\\"token operator\\">=</span> auth<span class=\\"token punctuation\\">.</span>expirationTime <span class=\\"token operator\\">-</span> Date<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">now</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token comment\\">// 判断timeout的值</span>\\n        <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>timeout <span class=\\"token operator\\">&lt;</span> <span class=\\"token number\\">6000</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n            <span class=\\"token function\\">dispatch</span><span class=\\"token punctuation\\">(</span><span class=\\"token function\\">logout</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n            <span class=\\"token keyword\\">return</span><span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token keyword\\">const</span> timer <span class=\\"token operator\\">=</span> <span class=\\"token function\\">setTimeout</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=&gt;</span> <span class=\\"token punctuation\\">{</span>\\n            <span class=\\"token function\\">dispatch</span><span class=\\"token punctuation\\">(</span><span class=\\"token function\\">logout</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> timeout<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n\\n        <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=&gt;</span> <span class=\\"token punctuation\\">{</span>\\n            <span class=\\"token function\\">clearTimeout</span><span class=\\"token punctuation\\">(</span>timer<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>\\n    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span>auth<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>\\n\\n<span class=\\"token keyword\\">export</span> <span class=\\"token keyword\\">default</span> useAutoLogout<span class=\\"token punctuation\\">;</span>\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","copyright":{"author":"XiaoAjun"},"autoDesc":true}');export{n as data};
